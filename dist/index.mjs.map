{"version":3,"sources":["../components/MermaidRenderer/theme.ts","../components/MermaidRenderer/constants.ts","../components/MermaidRenderer/svgUtils.ts","../components/MermaidRenderer/particleUtils.ts","../components/MermaidRenderer/exportUtils.ts","../components/MermaidRenderer/index.tsx"],"names":["imageMappings"],"mappings":"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","file":"index.mjs","sourcesContent":["/**\n * Color Theme - Inspired by Truemed Design System\n *\n * A warm, organic aesthetic with a sustainable feel.\n * Sophisticated teals and cyans balanced with warm off-white backgrounds.\n */\n\n/**\n * Primary brand colors\n */\nexport const PRIMARY = {\n  teal: '#179895',\n  tealLight: '#679b9a',\n  cyanDark: '#183B43',\n} as const;\n\n/**\n * Accent colors for highlights and emphasis\n */\nexport const ACCENT = {\n  yellow: '#FFF6A8',\n  red: '#E43028',\n  cyanLight: '#D9F5EA',\n  cyanSoft: '#F4FFFB',\n} as const;\n\n/**\n * Background colors\n */\nexport const BACKGROUND = {\n  primary: '#F7F6F2',\n  white: '#FFFFFF',\n  gray100: '#EDF2F7',\n} as const;\n\n/**\n * Text colors\n */\nexport const TEXT = {\n  body: '#1A202C',\n  subtle: '#4A5568',\n  placeholder: '#718096',\n} as const;\n\n/**\n * Semantic color mappings for diagram elements\n */\nexport const DIAGRAM = {\n  // Node styling\n  nodeFill: 'rgba(23, 152, 149, 0.1)',\n  nodeStroke: PRIMARY.teal,\n  nodeStrokeHover: PRIMARY.tealLight,\n\n  // Edge styling\n  edgeStroke: PRIMARY.teal,\n  edgeStrokeHover: PRIMARY.tealLight,\n\n  // Particle colors\n  particleCore: PRIMARY.teal,\n  particleGlow: PRIMARY.tealLight,\n  particleHalo: ACCENT.cyanLight,\n\n  // Label styling\n  labelText: TEXT.body,\n  labelBackground: BACKGROUND.white,\n  labelBorder: PRIMARY.teal,\n\n  // Container\n  containerBackground: `linear-gradient(135deg, ${BACKGROUND.primary} 0%, ${ACCENT.cyanSoft} 50%, ${BACKGROUND.primary} 100%)`,\n\n  // Glow effects\n  glowPrimary: PRIMARY.teal,\n  glowSecondary: PRIMARY.tealLight,\n} as const;\n\n/**\n * Typography scale\n */\nexport const TYPOGRAPHY = {\n  nodeLabelSize: '16px',\n  edgeLabelSize: '15px',\n  fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", sans-serif',\n  fontWeight: {\n    normal: 500,\n    semibold: 600,\n    bold: 700,\n  },\n} as const;\n\n/**\n * Spacing and sizing\n */\nexport const SIZING = {\n  strokeWidth: {\n    node: 3,\n    edge: 3,\n    edgeLabel: 2.5,\n  },\n  borderRadius: {\n    node: 12,\n    edgeLabel: 10,\n  },\n  padding: {\n    container: '6rem',\n    edgeLabel: '12px 16px',\n  },\n  minSize: {\n    edgeLabelWidth: 90,\n    edgeLabelHeight: 50,\n  },\n} as const;\n\n/**\n * Animation timings\n */\nexport const ANIMATION = {\n  nodeGlow: '6s',\n  edgePulse: '5s',\n  particleDuration: {\n    min: 2000,\n    max: 3500,\n  },\n} as const;\n\n/**\n * Helper function to convert hex to rgba\n */\nexport function hexToRgba(hex: string, alpha: number): string {\n  const r = parseInt(hex.slice(1, 3), 16);\n  const g = parseInt(hex.slice(3, 5), 16);\n  const b = parseInt(hex.slice(5, 7), 16);\n  return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n}\n","/**\n * Configuration constants for the Mermaid Renderer\n */\n\nimport { MermaidConfig, ParticleConfig, ParticleStyle } from './types';\nimport { PRIMARY, ACCENT, BACKGROUND, TEXT, hexToRgba } from './theme';\n\n/**\n * Mermaid.js initialization configuration\n */\nexport const MERMAID_CONFIG: MermaidConfig = {\n  startOnLoad: false,\n  theme: 'base',\n  themeVariables: {\n    primaryColor: PRIMARY.teal,\n    primaryTextColor: TEXT.body,\n    primaryBorderColor: PRIMARY.tealLight,\n    lineColor: PRIMARY.teal,\n    secondaryColor: PRIMARY.tealLight,\n    tertiaryColor: ACCENT.cyanLight,\n    background: BACKGROUND.white,\n    mainBkg: BACKGROUND.white,\n    nodeBorder: PRIMARY.teal,\n    clusterBkg: ACCENT.cyanSoft,\n    clusterBorder: PRIMARY.tealLight,\n    // Sequence diagram specific\n    actorBkg: BACKGROUND.white,\n    actorBorder: PRIMARY.teal,\n    actorTextColor: TEXT.body,\n    actorLineColor: PRIMARY.teal,\n    signalColor: TEXT.body,\n    signalTextColor: TEXT.body,\n  },\n  sequence: {\n    diagramMarginX: 100,\n    diagramMarginY: 80,\n    actorMargin: 150,\n    width: 300,\n    height: 120,\n    boxMargin: 25,\n    boxTextMargin: 15,\n    noteMargin: 25,\n    messageMargin: 80,\n    mirrorActors: true,\n    useMaxWidth: true,\n  },\n};\n\n/**\n * Configuration for particle animations\n * Particles now run sequentially through edges\n */\nexport const PARTICLE_CONFIG: ParticleConfig = {\n  particleCount: 1,\n  minDuration: 2000,\n  maxDuration: 3500,\n  durationMultiplier: 15,\n};\n\n/**\n * Visual styling for particles\n */\nexport const PARTICLE_STYLE: ParticleStyle = {\n  outerGlow: {\n    radius: 8,\n    fill: ACCENT.cyanLight,\n    opacity: 0.15,\n  },\n  core: {\n    radius: 3,\n    fill: PRIMARY.teal,\n    opacity: 0.5,\n  },\n  innerGlow: {\n    radius: 1.5,\n    fill: PRIMARY.tealLight,\n    opacity: 0.4,\n  },\n};\n\n/**\n * CSS class names used by Mermaid for different diagram elements\n */\nexport const MERMAID_SELECTORS = {\n  // Node selectors\n  nodes: '.node rect, .node polygon, .node circle, .node ellipse',\n  nodeLabels: '.nodeLabel',\n\n  // Edge selectors (in order of priority)\n  edges: [\n    '.flowchart-link',\n    '.messageLine0',\n    '.messageLine1',\n    '.edgePath path',\n    'path.edge',\n  ],\n  edgeLabels: '.edgeLabel',\n  edgeLabelRects: '.edgeLabel rect',\n\n  // Marker selectors\n  markers: 'marker',\n};\n\n/**\n * Minimum dimensions for edge label boxes (Yes/No labels)\n */\nexport const EDGE_LABEL_MIN_SIZE = {\n  width: 90,\n  height: 50,\n  borderRadius: 12,\n};\n\n/**\n * Unique ID for the rendered Mermaid diagram\n */\nexport const DIAGRAM_ID = 'mermaid-diagram';\n","/**\n * Utilities for enhancing SVG elements with custom styles and animations\n */\n\nimport { MERMAID_SELECTORS, EDGE_LABEL_MIN_SIZE } from './constants';\n\n/**\n * Adds animated styles to all node elements (boxes, circles, etc.)\n */\nexport function enhanceNodes(svgElement: SVGSVGElement): void {\n  const nodes = svgElement.querySelectorAll(MERMAID_SELECTORS.nodes);\n  nodes.forEach((node) => {\n    node.classList.add('animated-node');\n\n    // Add rounded corners to rectangles\n    if (node.tagName === 'rect') {\n      node.setAttribute('rx', '10');\n      node.setAttribute('ry', '10');\n    }\n  });\n}\n\n/**\n * Adds animated styles to all label elements\n */\nexport function enhanceLabels(svgElement: SVGSVGElement): void {\n  const nodeLabels = svgElement.querySelectorAll(MERMAID_SELECTORS.nodeLabels);\n  const edgeLabels = svgElement.querySelectorAll(MERMAID_SELECTORS.edgeLabels);\n\n  [...nodeLabels, ...edgeLabels].forEach((label) => {\n    label.classList.add('animated-label');\n  });\n}\n\n/**\n * Enforces minimum dimensions and rounded corners on edge label boxes\n * (e.g., \"Yes\" and \"No\" labels on decision branches)\n */\nexport function enhanceEdgeLabelBoxes(svgElement: SVGSVGElement): void {\n  const edgeLabelRects = svgElement.querySelectorAll(MERMAID_SELECTORS.edgeLabelRects);\n  const { width: minWidth, height: minHeight, borderRadius } = EDGE_LABEL_MIN_SIZE;\n\n  edgeLabelRects.forEach((rect) => {\n    const width = parseFloat(rect.getAttribute('width') || '0');\n    const height = parseFloat(rect.getAttribute('height') || '0');\n\n    // Add padding to the dimensions\n    const paddedMinWidth = minWidth + 20;\n    const paddedMinHeight = minHeight + 10;\n\n    // Always enforce minimum width with padding\n    const newWidth = Math.max(width, paddedMinWidth);\n    if (newWidth !== width) {\n      rect.setAttribute('width', newWidth.toString());\n      const x = parseFloat(rect.getAttribute('x') || '0');\n      rect.setAttribute('x', (x - (newWidth - width) / 2).toString());\n    }\n\n    // Always enforce minimum height with padding\n    const newHeight = Math.max(height, paddedMinHeight);\n    if (newHeight !== height) {\n      rect.setAttribute('height', newHeight.toString());\n      const y = parseFloat(rect.getAttribute('y') || '0');\n      rect.setAttribute('y', (y - (newHeight - height) / 2).toString());\n    }\n\n    // Add rounded corners\n    rect.setAttribute('rx', borderRadius.toString());\n    rect.setAttribute('ry', borderRadius.toString());\n  });\n}\n\n/**\n * Finds edge paths using multiple selector strategies\n * Mermaid uses different class names for different diagram types\n */\nexport function findEdgePaths(svgElement: SVGSVGElement): NodeListOf<Element> | Element[] {\n  // Try each selector in order of priority\n  for (const selector of MERMAID_SELECTORS.edges) {\n    const edges = svgElement.querySelectorAll(selector);\n    if (edges.length > 0) {\n      return edges;\n    }\n  }\n\n  // Fallback: find all paths that are NOT part of nodes or markers\n  const allPaths = svgElement.querySelectorAll('path');\n  return Array.from(allPaths).filter((path) => {\n    const parent = path.parentElement;\n    const isNotNode = !parent?.classList.contains('node');\n    const isNotMarker = parent?.tagName?.toLowerCase() !== 'marker';\n    return isNotNode && isNotMarker;\n  });\n}\n\n/**\n * Adds animated styles to edge paths (arrows)\n */\nexport function enhanceEdges(svgElement: SVGSVGElement): NodeListOf<Element> | Element[] {\n  const edges = findEdgePaths(svgElement);\n\n  edges.forEach((edge) => {\n    edge.classList.add('animated-edge');\n  });\n\n  return edges;\n}\n\n/**\n * Creates a dedicated group for particle elements\n * This ensures particles render on top of all other SVG elements\n */\nexport function createParticleLayer(svgElement: SVGSVGElement): SVGGElement {\n  const particleGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  particleGroup.setAttribute('class', 'particle-layer');\n  svgElement.appendChild(particleGroup);\n  return particleGroup;\n}\n\n/**\n * Fixes arrow markers to prevent line from extending past arrowhead\n */\nexport function fixArrowMarkers(svgElement: SVGSVGElement): void {\n  // Find all marker elements (arrowheads)\n  const markers = svgElement.querySelectorAll('marker');\n\n  markers.forEach((marker) => {\n    const id = marker.getAttribute('id');\n\n    // Only fix arrowhead markers (not other marker types)\n    if (id && (id.includes('arrowhead') || id.includes('flowchart') || id.includes('arrow'))) {\n      // Adjust refX to position the marker so the path ends at the base of the arrowhead\n      // This prevents the line from extending past the arrowhead\n      const currentRefX = parseFloat(marker.getAttribute('refX') || '5');\n\n      // Reduce refX slightly so the line stops right where the arrowhead begins\n      // The amount to reduce depends on the stroke width (currently 4-5px)\n      const adjustedRefX = currentRefX - 2.5; // Pull back by 2.5 units\n\n      marker.setAttribute('refX', adjustedRefX.toString());\n    }\n  });\n}\n\n/**\n * Configures SVG rendering optimizations\n */\nexport function configureSVGRendering(svgElement: SVGSVGElement): void {\n  // Remove any inline overflow styles that might interfere\n  svgElement.style.removeProperty('overflow');\n}\n\n/**\n * Applies all SVG enhancements in the correct order\n */\nexport function enhanceSVG(svgElement: SVGSVGElement): {\n  edges: NodeListOf<Element> | Element[];\n  particleGroup: SVGGElement;\n} {\n  configureSVGRendering(svgElement);\n  enhanceNodes(svgElement);\n  enhanceLabels(svgElement);\n  enhanceEdgeLabelBoxes(svgElement);\n  const edges = enhanceEdges(svgElement);\n  fixArrowMarkers(svgElement);\n  const particleGroup = createParticleLayer(svgElement);\n\n  return { edges, particleGroup };\n}\n","/**\n * Utilities for creating and animating particles along arrow paths\n */\n\nimport { ParticleAnimation, ParticleStyle } from './types';\nimport { PARTICLE_CONFIG, PARTICLE_STYLE } from './constants';\n\n/**\n * Creates a single SVG circle element with specified attributes\n */\nfunction createCircle(\n  radius: number,\n  fill: string,\n  opacity: number,\n  className: string\n): SVGCircleElement {\n  const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n  circle.setAttribute('r', radius.toString());\n  circle.setAttribute('fill', fill);\n  circle.setAttribute('opacity', opacity.toString());\n  circle.setAttribute('class', className);\n  circle.setAttribute('cx', '0');\n  circle.setAttribute('cy', '0');\n  return circle;\n}\n\n/**\n * Creates a three-layer particle (outer glow, core, inner glow)\n * and adds them to the particle group\n */\nexport function createParticle(\n  particleGroup: SVGGElement,\n  style: ParticleStyle = PARTICLE_STYLE\n): {\n  outerGlow: SVGCircleElement;\n  core: SVGCircleElement;\n  innerGlow: SVGCircleElement;\n} {\n  const outerGlow = createCircle(\n    style.outerGlow.radius,\n    style.outerGlow.fill,\n    style.outerGlow.opacity,\n    'particle-outer-glow'\n  );\n\n  const core = createCircle(\n    style.core.radius,\n    style.core.fill,\n    style.core.opacity,\n    'edge-particle'\n  );\n\n  const innerGlow = createCircle(\n    style.innerGlow.radius,\n    style.innerGlow.fill,\n    style.innerGlow.opacity,\n    'particle-inner-glow'\n  );\n\n  particleGroup.appendChild(outerGlow);\n  particleGroup.appendChild(core);\n  particleGroup.appendChild(innerGlow);\n\n  return { outerGlow, core, innerGlow };\n}\n\n/**\n * Calculates animation duration based on path length\n */\nexport function calculateDuration(pathLength: number): number {\n  const { minDuration, maxDuration, durationMultiplier } = PARTICLE_CONFIG;\n  return Math.max(minDuration, Math.min(maxDuration, pathLength * durationMultiplier));\n}\n\n/**\n * Creates all particle animations for a given path\n * For sequential animation, cumulativeStartTime should be the end time of the previous particle\n */\nexport function createParticlesForPath(\n  path: SVGPathElement,\n  cumulativeStartTime: number,\n  particleGroup: SVGGElement\n): { animations: ParticleAnimation[]; nextStartTime: number } {\n  const animations: ParticleAnimation[] = [];\n  const pathLength = path.getTotalLength();\n  const duration = calculateDuration(pathLength);\n  const { particleCount } = PARTICLE_CONFIG;\n\n  for (let i = 0; i < particleCount; i++) {\n    const { outerGlow, core, innerGlow } = createParticle(particleGroup);\n\n    // Track the main particle (core) animation\n    animations.push({\n      element: core,\n      glowElement: innerGlow,\n      path,\n      pathLength,\n      duration,\n      offset: 0, // No offset for sequential animation\n      startTime: cumulativeStartTime,\n    });\n\n    // Track the outer glow animation (follows the same path)\n    animations.push({\n      element: outerGlow,\n      glowElement: outerGlow, // Dummy reference\n      path,\n      pathLength,\n      duration,\n      offset: 0, // No offset for sequential animation\n      startTime: cumulativeStartTime,\n    });\n  }\n\n  // Return the next start time (current start + duration)\n  const nextStartTime = cumulativeStartTime + duration;\n  return { animations, nextStartTime };\n}\n\n/**\n * Ease-in-out cubic easing function\n * Provides smooth acceleration and deceleration\n */\nfunction easeInOutCubic(t: number): number {\n  return t < 0.5\n    ? 4 * t * t * t\n    : 1 - Math.pow(-2 * t + 2, 3) / 2;\n}\n\n/**\n * Calculate opacity based on progress for fade in/out effect\n * Fades in from 0-15%, full opacity 15-85%, fades out 85-100%\n */\nfunction calculateOpacity(progress: number): number {\n  const fadeInEnd = 0.15;\n  const fadeOutStart = 0.85;\n\n  if (progress < fadeInEnd) {\n    // Fade in\n    return progress / fadeInEnd;\n  } else if (progress > fadeOutStart) {\n    // Fade out\n    return (1 - progress) / (1 - fadeOutStart);\n  } else {\n    // Full opacity\n    return 1;\n  }\n}\n\n/**\n * Updates the position of a single particle based on elapsed time\n * For sequential animation, particles only show when it's their turn in the sequence\n */\nexport function updateParticlePosition(\n  animation: ParticleAnimation,\n  currentTime: number,\n  isCore: boolean,\n  totalSequenceDuration: number,\n  sequenceStartTime: number\n): void {\n  // Calculate where we are in the full sequence cycle\n  const timeSinceSequenceStart = currentTime - sequenceStartTime;\n  const cycleTime = timeSinceSequenceStart % totalSequenceDuration;\n\n  // Calculate when this particle should be active in the sequence\n  const particleStartInSequence = animation.startTime - sequenceStartTime;\n  const particleEndInSequence = particleStartInSequence + animation.duration;\n\n  // Check if this particle should be animating right now\n  const isInActiveWindow = cycleTime >= particleStartInSequence && cycleTime < particleEndInSequence;\n\n  if (!isInActiveWindow) {\n    // Hide the particle when it's not active\n    animation.element.setAttribute('opacity', '0');\n    if (isCore && animation.glowElement !== animation.element) {\n      animation.glowElement.setAttribute('opacity', '0');\n    }\n    return;\n  }\n\n  // Calculate progress within this particle's animation\n  const progressInParticle = (cycleTime - particleStartInSequence) / animation.duration;\n\n  // Apply easing for smooth motion\n  const easedProgress = easeInOutCubic(progressInParticle);\n  const distance = easedProgress * animation.pathLength;\n\n  // Calculate opacity for fade in/out (use raw progress, not eased)\n  const opacity = calculateOpacity(progressInParticle);\n\n  try {\n    const point = animation.path.getPointAtLength(distance);\n    animation.element.setAttribute('cx', point.x.toString());\n    animation.element.setAttribute('cy', point.y.toString());\n    animation.element.setAttribute('opacity', opacity.toString());\n\n    // Update inner glow position and opacity (only for core particles, not outer glows)\n    if (isCore && animation.glowElement !== animation.element) {\n      animation.glowElement.setAttribute('cx', point.x.toString());\n      animation.glowElement.setAttribute('cy', point.y.toString());\n      animation.glowElement.setAttribute('opacity', opacity.toString());\n    }\n  } catch (e) {\n    // Path might be invalid or animation not ready, skip silently\n  }\n}\n\n/**\n * Creates and starts the main animation loop for all particles\n * Particles animate sequentially, looping through the full sequence\n */\nexport function startParticleAnimation(\n  animations: ParticleAnimation[]\n): () => void {\n  if (animations.length === 0) return () => {};\n\n  let animationFrameId: number;\n\n  // Calculate total sequence duration\n  // Find the latest end time (startTime + duration) among all animations\n  const sequenceStartTime = animations[0].startTime;\n  let totalSequenceDuration = 0;\n\n  // Since particles come in pairs (core and outer glow), we only need to check even indices\n  for (let i = 0; i < animations.length; i += 2) {\n    const anim = animations[i];\n    const endTime = anim.startTime + anim.duration - sequenceStartTime;\n    if (endTime > totalSequenceDuration) {\n      totalSequenceDuration = endTime;\n    }\n  }\n\n  const animate = () => {\n    const currentTime = Date.now();\n\n    animations.forEach((anim, index) => {\n      // Every even index is a core particle, odd indices are outer glows\n      const isCore = index % 2 === 0;\n      updateParticlePosition(anim, currentTime, isCore, totalSequenceDuration, sequenceStartTime);\n    });\n\n    animationFrameId = requestAnimationFrame(animate);\n  };\n\n  animate();\n\n  // Return cleanup function\n  return () => {\n    if (animationFrameId) {\n      cancelAnimationFrame(animationFrameId);\n    }\n  };\n}\n","/**\n * Export utilities for saving Mermaid diagrams as image files\n */\n\n/**\n * Exports an SVG element as a PNG file\n */\nexport async function exportAsPNG(\n  svgElement: SVGSVGElement,\n  filename: string = 'diagram.png'\n): Promise<void> {\n  const canvas = await svgToCanvas(svgElement);\n  downloadCanvas(canvas, filename, 'image/png');\n}\n\n/**\n * Exports an SVG element as a JPG file\n */\nexport async function exportAsJPG(\n  svgElement: SVGSVGElement,\n  filename: string = 'diagram.jpg'\n): Promise<void> {\n  const canvas = await svgToCanvas(svgElement, '#FFFFFF'); // White background for JPG\n  downloadCanvas(canvas, filename, 'image/jpeg');\n}\n\n/**\n * Exports an SVG element as an SVG file with inlined styles\n */\nexport async function exportAsSVG(\n  svgElement: SVGSVGElement,\n  filename: string = 'diagram.svg'\n): Promise<void> {\n  // Clone the SVG with inlined styles (now async to handle images)\n  const svgClone = await inlineStyles(svgElement);\n\n  // Add xmlns if not present\n  if (!svgClone.getAttribute('xmlns')) {\n    svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n  }\n\n  // Serialize the SVG\n  const serializer = new XMLSerializer();\n  const svgString = serializer.serializeToString(svgClone);\n\n  // Create blob and download\n  const blob = new Blob([svgString], { type: 'image/svg+xml' });\n  const url = URL.createObjectURL(blob);\n\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Converts an image URL to a data URI\n */\nasync function urlToDataUri(url: string): Promise<string> {\n  try {\n    const response = await fetch(url);\n    const blob = await response.blob();\n    return new Promise<string>((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => resolve(reader.result as string);\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  } catch (error) {\n    console.warn('Failed to convert image to data URI:', url, error);\n    return url; // Return original URL as fallback\n  }\n}\n\n/**\n * Inlines all CSS styles and converts images to data URIs\n */\nasync function inlineStyles(svgElement: SVGSVGElement): Promise<SVGSVGElement> {\n  const svgClone = svgElement.cloneNode(true) as SVGSVGElement;\n\n  // Get all style sheets\n  const allStyles: string[] = [];\n  for (let i = 0; i < document.styleSheets.length; i++) {\n    const sheet = document.styleSheets[i];\n    try {\n      if (sheet.cssRules) {\n        for (let j = 0; j < sheet.cssRules.length; j++) {\n          const rule = sheet.cssRules[j];\n          allStyles.push(rule.cssText);\n        }\n      }\n    } catch (e) {\n      // Skip stylesheets that can't be accessed (CORS)\n      console.warn('Could not access stylesheet:', e);\n    }\n  }\n\n  // Create a style element with all the CSS\n  const styleElement = document.createElementNS('http://www.w3.org/2000/svg', 'style');\n  styleElement.textContent = allStyles.join('\\n');\n  svgClone.insertBefore(styleElement, svgClone.firstChild);\n\n  // Convert all image elements to use data URIs\n  const images = svgClone.querySelectorAll('image');\n  const imagePromises: Promise<void>[] = [];\n\n  images.forEach((img) => {\n    const href = img.getAttribute('href') || img.getAttribute('xlink:href');\n    if (href && href.startsWith('http')) {\n      const promise = urlToDataUri(href).then((dataUri) => {\n        img.setAttribute('href', dataUri);\n        img.removeAttribute('xlink:href');\n      });\n      imagePromises.push(promise);\n    }\n  });\n\n  // Wait for all images to be converted\n  await Promise.all(imagePromises);\n\n  return svgClone;\n}\n\n/**\n * Converts an SVG element to a canvas with proper styling\n */\nasync function svgToCanvas(\n  svgElement: SVGSVGElement,\n  backgroundColor?: string\n): Promise<HTMLCanvasElement> {\n  // Get the container's background\n  const container = svgElement.closest('.mermaid-container') as HTMLElement;\n  const containerStyle = container ? window.getComputedStyle(container) : null;\n\n  // Get SVG dimensions\n  const bbox = svgElement.getBoundingClientRect();\n  const width = bbox.width;\n  const height = bbox.height;\n\n  // Clone SVG with inlined styles (this is now async to handle images)\n  const svgClone = await inlineStyles(svgElement);\n\n  // Set xmlns if not present\n  if (!svgClone.getAttribute('xmlns')) {\n    svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n  }\n\n  // Set explicit width and height\n  svgClone.setAttribute('width', width.toString());\n  svgClone.setAttribute('height', height.toString());\n\n  const serializer = new XMLSerializer();\n  const svgString = serializer.serializeToString(svgClone);\n\n  // Create image from SVG\n  const img = new Image();\n  const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\n  const url = URL.createObjectURL(svgBlob);\n\n  // Wait for image to load\n  await new Promise<void>((resolve, reject) => {\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n      resolve();\n    };\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new Error('Failed to load SVG as image'));\n    };\n    img.src = url;\n  });\n\n  // Create canvas and draw\n  const canvas = document.createElement('canvas');\n  const scale = 2; // 2x resolution for better quality\n  const padding = 100; // Add padding around the diagram\n  canvas.width = (width + padding * 2) * scale;\n  canvas.height = (height + padding * 2) * scale;\n\n  const ctx = canvas.getContext('2d');\n  if (!ctx) {\n    throw new Error('Failed to get canvas context');\n  }\n\n  ctx.scale(scale, scale);\n\n  // Add background from container or specified color\n  if (backgroundColor) {\n    ctx.fillStyle = backgroundColor;\n  } else if (containerStyle?.background) {\n    // Try to use the container's background\n    ctx.fillStyle = '#F7F6F2'; // Default Truemed background\n  } else {\n    ctx.fillStyle = '#F7F6F2';\n  }\n  ctx.fillRect(0, 0, width + padding * 2, height + padding * 2);\n\n  // Draw the SVG with padding\n  ctx.drawImage(img, padding, padding, width, height);\n\n  return canvas;\n}\n\n/**\n * Downloads a canvas as an image file\n */\nfunction downloadCanvas(\n  canvas: HTMLCanvasElement,\n  filename: string,\n  mimeType: string\n): void {\n  canvas.toBlob((blob) => {\n    if (!blob) {\n      throw new Error('Failed to create blob from canvas');\n    }\n\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n  }, mimeType);\n}\n","'use client';\n\n/**\n * MermaidRenderer Component\n *\n * A React component that renders Mermaid diagrams with beautiful animations:\n * - Glowing borders on nodes with pulsing effects\n * - Animated arrows with color transitions\n * - Light particles traveling along arrow paths\n * - Modern dark theme with gradient backgrounds\n *\n * @example\n * ```tsx\n * <MermaidRenderer chart={`\n *   graph TD\n *     A[Start] --> B[End]\n * `} />\n * ```\n */\n\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport mermaid from 'mermaid';\nimport { MermaidRendererProps, ParticleAnimation, NodeEventData, EdgeEventData } from './types';\nimport { MERMAID_CONFIG, DIAGRAM_ID } from './constants';\nimport { enhanceSVG } from './svgUtils';\nimport { createParticlesForPath, startParticleAnimation } from './particleUtils';\nimport { PRIMARY } from './theme';\nimport './styles.css';\n\n/**\n * Initializes Mermaid.js with custom theme configuration\n */\nfunction initializeMermaid(): void {\n  mermaid.initialize(MERMAID_CONFIG);\n}\n\n/**\n * Preprocesses chart string to extract image references and clean for Mermaid\n * Returns cleaned chart and image mappings\n */\nfunction preprocessChart(chart: string): { cleanedChart: string; imageMappings: Map<string, string> } {\n  const imageMappings = new Map<string, string>();\n\n  // Extract and remove img: references from participant definitions\n  const cleanedChart = chart.replace(/participant\\s+img:([^\\s]+)\\s+([^\\n]+)/g, (match, imgPath, actorName) => {\n    const trimmedName = actorName.trim();\n    imageMappings.set(trimmedName, imgPath);\n    return `participant ${actorName}`;\n  });\n\n  return { cleanedChart, imageMappings };\n}\n\n/**\n * Adds images to actor boxes based on mappings\n */\nfunction addActorImages(svgElement: SVGSVGElement, imageMappings: Map<string, string>): void {\n  if (imageMappings.size === 0) {\n    return;\n  }\n\n  const allGroups = svgElement.querySelectorAll('g');\n\n  // Try to find actor groups by their content\n  const actorCandidates = Array.from(allGroups).filter(g => {\n    const hasRect = g.querySelector('rect') !== null;\n    const hasText = g.querySelector('text') !== null;\n    const className = g.getAttribute('class') || '';\n    return hasRect && hasText && (className.includes('actor') || g.querySelector('line'));\n  });\n\n  actorCandidates.forEach((actor) => {\n    // Look for text anywhere in the actor (not just direct children)\n    const textElement = actor.querySelector('text');\n    // Look for rect anywhere in the actor\n    const rect = actor.querySelector('rect');\n\n    if (!textElement || !rect) {\n      return;\n    }\n\n    const actorName = textElement.textContent?.trim() || '';\n    const imgPath = imageMappings.get(actorName);\n\n    if (imgPath) {\n      // Get the rect dimensions and position\n      const x = parseFloat(rect.getAttribute('x') || '0');\n      const y = parseFloat(rect.getAttribute('y') || '0');\n      const height = parseFloat(rect.getAttribute('height') || '0');\n\n      const logoSize = 48;\n      const padding = 20;\n      const imageX = x + padding;\n      const imageY = y + (height - logoSize) / 2;\n      const borderRadius = 8;\n\n      // Create a unique ID for this clip path\n      const clipPathId = `actor-logo-clip-${Math.random().toString(36).substr(2, 9)}`;\n\n      // Create clip path with rounded rectangle\n      const defs = svgElement.querySelector('defs') || svgElement.insertBefore(\n        document.createElementNS('http://www.w3.org/2000/svg', 'defs'),\n        svgElement.firstChild\n      );\n\n      const clipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');\n      clipPath.setAttribute('id', clipPathId);\n\n      const clipRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n      clipRect.setAttribute('x', imageX.toString());\n      clipRect.setAttribute('y', imageY.toString());\n      clipRect.setAttribute('width', logoSize.toString());\n      clipRect.setAttribute('height', logoSize.toString());\n      clipRect.setAttribute('rx', borderRadius.toString());\n      clipRect.setAttribute('ry', borderRadius.toString());\n\n      clipPath.appendChild(clipRect);\n      defs.appendChild(clipPath);\n\n      // Create image element\n      const image = document.createElementNS('http://www.w3.org/2000/svg', 'image');\n      image.setAttribute('href', imgPath);\n      image.setAttribute('x', imageX.toString());\n      image.setAttribute('y', imageY.toString());\n      image.setAttribute('width', logoSize.toString());\n      image.setAttribute('height', logoSize.toString());\n      image.setAttribute('class', 'actor-logo');\n      image.setAttribute('clip-path', `url(#${clipPathId})`);\n\n      // Adjust text position to make room for logo (tighter spacing)\n      const textX = parseFloat(textElement.getAttribute('x') || '0');\n      const textShift = logoSize + 4; // Logo width plus 4px gap\n      textElement.setAttribute('x', (textX + textShift / 2).toString());\n\n      // Insert the image into the actor group\n      actor.appendChild(image);\n    }\n  });\n}\n\n/**\n * Renders a Mermaid diagram from text syntax\n */\nasync function renderDiagram(chart: string): Promise<{ svg: string; imageMappings: Map<string, string> }> {\n  try {\n    const { cleanedChart, imageMappings } = preprocessChart(chart);\n    const { svg } = await mermaid.render(DIAGRAM_ID, cleanedChart);\n    return { svg, imageMappings };\n  } catch (error) {\n    console.error('Mermaid rendering error:', error);\n    throw error;\n  }\n}\n\n/**\n * Sets up particle animations for all edges in the SVG\n * Particles run sequentially, one completing before the next begins\n */\nfunction setupParticleAnimations(\n  svgElement: SVGSVGElement\n): () => void {\n  const { edges, particleGroup } = enhanceSVG(svgElement);\n  const animations: ParticleAnimation[] = [];\n\n  // Create particles sequentially - each starts after the previous one completes\n  let cumulativeStartTime = Date.now();\n\n  edges.forEach((edge) => {\n    const pathElement = edge as SVGPathElement;\n    const result = createParticlesForPath(\n      pathElement,\n      cumulativeStartTime,\n      particleGroup\n    );\n    animations.push(...result.animations);\n    cumulativeStartTime = result.nextStartTime;\n  });\n\n  // Start the animation loop and return cleanup function\n  return startParticleAnimation(animations);\n}\n\n/**\n * Main MermaidVibes Component\n */\nexport const MermaidVibes: React.FC<MermaidRendererProps> = ({\n  chart,\n  theme,\n  className = '',\n  disableAnimations = false,\n  disableParticles = false,\n  onNodeClick,\n  onNodeHover,\n  onEdgeClick,\n  onEdgeHover,\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [svgContent, setSvgContent] = useState<string>('');\n  const [imageMappings, setImageMappings] = useState<Map<string, string>>(new Map());\n\n  // Initialize Mermaid and render diagram when chart changes\n  useEffect(() => {\n    initializeMermaid();\n\n    const renderChart = async () => {\n      const { svg, imageMappings } = await renderDiagram(chart);\n      setSvgContent(svg);\n      setImageMappings(imageMappings);\n    };\n\n    renderChart();\n  }, [chart]);\n\n  // Setup event listeners for node and edge interactions\n  const setupInteractivity = useCallback(\n    (svgElement: SVGSVGElement) => {\n      // Helper to find the label for a node\n      const findNodeLabel = (element: Element): string | undefined => {\n        // If we clicked on a rect, image, or other shape, look in the parent group for text\n        const searchElement = element.tagName === 'rect' || element.tagName === 'circle' || element.tagName === 'path' || element.tagName === 'image'\n          ? element.parentElement\n          : element;\n\n        if (!searchElement) return undefined;\n\n        // Strategy 1: Look for text in common Mermaid label elements (descendants)\n        const labelSelectors = [\n          'text',           // Direct text element (actors, basic nodes)\n          '.nodeLabel',     // Flowchart node labels\n          '.label',         // Generic labels\n          'tspan',          // Text spans inside text elements\n          'foreignObject'   // HTML labels\n        ];\n\n        for (const selector of labelSelectors) {\n          const labelElement = searchElement.querySelector(selector);\n          if (labelElement) {\n            const text = (labelElement.textContent || '').trim();\n            // Return if we found meaningful text (not empty, not too long)\n            if (text && text.length > 0 && text.length < 200) {\n              return text;\n            }\n          }\n        }\n\n        // Strategy 2: Get all text content from search element as fallback\n        // Split by newline and take first non-empty line\n        const allText = (searchElement.textContent || '').trim();\n        const firstLine = allText.split('\\n').find(line => line.trim().length > 0);\n        if (firstLine && firstLine.length < 200) {\n          return firstLine.trim();\n        }\n\n        return undefined;\n      };\n\n      // Node interactions\n      if (onNodeClick || onNodeHover) {\n        const nodes = svgElement.querySelectorAll('.node, .actor, .stateGroup, .classGroup');\n\n        nodes.forEach((node) => {\n          const element = node as SVGElement;\n\n          if (onNodeClick) {\n            element.style.cursor = 'pointer';\n            element.addEventListener('click', (e) => {\n              e.stopPropagation(); // Prevent event bubbling that causes re-renders\n              const label = findNodeLabel(element);\n              const data: NodeEventData = {\n                element,\n                label,\n                bounds: element.getBoundingClientRect(),\n              };\n              onNodeClick(data);\n            });\n          }\n\n          if (onNodeHover) {\n            element.addEventListener('mouseenter', () => {\n              const label = findNodeLabel(element);\n              const data: NodeEventData = {\n                element,\n                label,\n                bounds: element.getBoundingClientRect(),\n              };\n              onNodeHover(data);\n            });\n\n            element.addEventListener('mouseleave', () => {\n              onNodeHover(null);\n            });\n          }\n        });\n      }\n\n      // Edge interactions\n      if (onEdgeClick || onEdgeHover) {\n        const edges = svgElement.querySelectorAll(\n          '.flowchart-link, .messageLine0, .messageLine1, .edgePath path, path.edge'\n        );\n\n        // Helper to find the label for an edge\n        const findEdgeLabel = (element: Element): string | undefined => {\n          // Try to find label in parent\n          const labelElement = element.parentElement?.querySelector('.edgeLabel text, .messageText');\n          if (labelElement?.textContent?.trim()) {\n            return labelElement.textContent.trim();\n          }\n\n          // Try to find label in siblings\n          const parent = element.parentElement;\n          if (parent) {\n            const labels = parent.querySelectorAll('.edgeLabel text, .messageText');\n            for (const label of labels) {\n              if (label.textContent?.trim()) {\n                return label.textContent.trim();\n              }\n            }\n          }\n\n          return undefined;\n        };\n\n        // Handle edge path clicks\n        edges.forEach((edge) => {\n          const pathElement = edge as SVGPathElement;\n\n          if (onEdgeClick) {\n            pathElement.style.cursor = 'pointer';\n            pathElement.addEventListener('click', () => {\n              const label = findEdgeLabel(pathElement);\n              const data: EdgeEventData = {\n                element: pathElement,\n                label,\n              };\n              onEdgeClick(data);\n            });\n          }\n\n          if (onEdgeHover) {\n            pathElement.addEventListener('mouseenter', () => {\n              const label = findEdgeLabel(pathElement);\n              const data: EdgeEventData = {\n                element: pathElement,\n                label,\n              };\n              onEdgeHover(data);\n            });\n\n            pathElement.addEventListener('mouseleave', () => {\n              onEdgeHover(null);\n            });\n          }\n        });\n\n        // Also handle edge label clicks\n        const edgeLabels = svgElement.querySelectorAll('.edgeLabel, .messageText');\n        edgeLabels.forEach((labelElement) => {\n          const label = labelElement.textContent?.trim();\n\n          if (onEdgeClick) {\n            (labelElement as HTMLElement).style.cursor = 'pointer';\n            labelElement.addEventListener('click', (e) => {\n              e.stopPropagation(); // Prevent bubbling to the path\n\n              // Find the associated path element\n              const parent = labelElement.closest('g');\n              const pathElement = parent?.querySelector('.flowchart-link, .messageLine0, .messageLine1, path') as SVGPathElement;\n\n              const data: EdgeEventData = {\n                element: pathElement || (labelElement as any),\n                label,\n              };\n              onEdgeClick(data);\n            });\n          }\n\n          if (onEdgeHover) {\n            labelElement.addEventListener('mouseenter', (e) => {\n              const parent = labelElement.closest('g');\n              const pathElement = parent?.querySelector('.flowchart-link, .messageLine0, .messageLine1, path') as SVGPathElement;\n\n              const data: EdgeEventData = {\n                element: pathElement || (labelElement as any),\n                label,\n              };\n              onEdgeHover(data);\n            });\n\n            labelElement.addEventListener('mouseleave', () => {\n              onEdgeHover(null);\n            });\n          }\n        });\n      }\n    },\n    [onNodeClick, onNodeHover, onEdgeClick, onEdgeHover]\n  );\n\n  // Apply custom theme\n  const applyCustomTheme = useCallback(\n    (svgElement: SVGSVGElement) => {\n      if (!theme) return;\n\n      const styleElement = document.createElement('style');\n      let customStyles = '';\n\n      if (theme.primaryColor) {\n        customStyles += `\n          .animated-node { stroke: ${theme.primaryColor} !important; }\n          .animated-edge { stroke: ${theme.primaryColor} !important; }\n          .actor { stroke: ${theme.primaryColor} !important; }\n          .messageLine0, .messageLine1 { stroke: ${theme.primaryColor} !important; }\n        `;\n      }\n\n      if (theme.strokeWidth) {\n        customStyles += `\n          .animated-node { stroke-width: ${theme.strokeWidth} !important; }\n          .animated-edge { stroke-width: ${theme.strokeWidth} !important; }\n        `;\n      }\n\n      if (theme.textColor) {\n        customStyles += `\n          .nodeLabel, .edgeLabel, .actor text, .messageText { fill: ${theme.textColor} !important; }\n        `;\n      }\n\n      if (theme.fontSize) {\n        customStyles += `\n          .nodeLabel, .edgeLabel text, .actor text { font-size: ${theme.fontSize}px !important; }\n        `;\n      }\n\n      if (customStyles) {\n        styleElement.textContent = customStyles;\n        svgElement.appendChild(styleElement);\n      }\n    },\n    [theme]\n  );\n\n  // Set up animations and images after SVG is rendered\n  useEffect(() => {\n    if (!containerRef.current || !svgContent) return;\n\n    const svgElement = containerRef.current.querySelector('svg');\n    if (!svgElement) return;\n\n    // Add actor images if there are any mappings\n    addActorImages(svgElement, imageMappings);\n\n    // Apply custom theme\n    applyCustomTheme(svgElement);\n\n    // Setup interactivity\n    setupInteractivity(svgElement);\n\n    // Disable animations if requested\n    if (disableAnimations) {\n      const animatedElements = svgElement.querySelectorAll('.animated-node, .animated-edge');\n      animatedElements.forEach((el) => {\n        (el as HTMLElement).style.animation = 'none';\n      });\n    }\n\n    // Setup particle animations unless disabled\n    let cleanup: (() => void) | undefined;\n    if (!disableParticles && !disableAnimations) {\n      cleanup = setupParticleAnimations(svgElement);\n    }\n\n    // Cleanup animation loop on unmount or re-render\n    return cleanup;\n  }, [svgContent, imageMappings, disableAnimations, disableParticles, applyCustomTheme, setupInteractivity]);\n\n  // Compute container styles\n  const containerStyles: React.CSSProperties = {\n    ...(theme?.backgroundColor && { background: theme.backgroundColor }),\n  };\n\n  return (\n    <div\n      className={`mermaid-container ${className} ${disableAnimations ? 'no-animations' : ''}`}\n      style={containerStyles}\n    >\n      <div\n        ref={containerRef}\n        className=\"mermaid-renderer\"\n        dangerouslySetInnerHTML={{ __html: svgContent }}\n      />\n    </div>\n  );\n};\n\n// Export types for external use\nexport type { MermaidRendererProps, CustomTheme, NodeEventData, EdgeEventData } from './types';\n\n// Export utility functions\nexport { exportAsPNG, exportAsJPG, exportAsSVG } from './exportUtils';\n"]}